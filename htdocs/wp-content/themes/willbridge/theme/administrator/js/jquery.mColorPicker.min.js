/**
 * @package WordPress
 * @subpackage Willbridge
 * @since Willbridge 1.0
 */

/**
 * mColorPicker
 * Version: 1.0 r38
 * 
 * Copyright (c) 2010 Meta100 LLC.
 * 
 * Licensed under the MIT license 
 * http://www.opensource.org/licenses/mit-license.php 
*/

(function(a){var b,c,d,e,f="<div>",g="<span>",h=a(document),i=a(f),j=a(f),k=a(f),l=a("<input>"),m=/^rgb[a]?\((\d+),\s*(\d+),\s*(\d+)(,\s*(\d+\.\d+)*)?\)/,n=/([a-f0-9])([a-f0-9])([a-f0-9])/,o=/#[a-f0-9]{3}/,p=/#[a-f0-9]{6}/;a.fn.mColorPicker=function(d){var e=a.fn.mColorPicker.getCookie("swatches");b=a.extend(a.fn.mColorPicker.defaults,d);a.fn.mColorPicker.defaults.swatches.concat(b.swatches).slice(-10);if(c.enhancedSwatches&&e)b.swatches=e.split("||").concat(b.swatches).slice(0,10)||b.swatches;if(!a("div#mColorPicker").length)a.fn.mColorPicker.drawPicker();if(!a("#css_disabled_color_picker").length)a("head").prepend('<meta data-remove-me="true"/><style id="css_disabled_color_picker" type="text/css">.mColorPicker[disabled] + span, .mColorPicker[disabled="disabled"] + span, .mColorPicker[disabled="true"] + span {filter:alpha(opacity=50);-moz-opacity:0.5;-webkit-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;cursor:default;}</style>');a("meta[data-remove-me=true]").remove();this.each(a.fn.mColorPicker.drawPickerTriggers);return this};a.fn.mColorPicker.init={replace:"[type=color]",index:0,enhancedSwatches:true,allowTransparency:true,slogan:"",showLogo:false};a.fn.mColorPicker.defaults={currentId:false,currentInput:false,currentColor:false,changeColor:false,color:false,imageFolder:"images/",swatches:["#ffffff","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000","#4c2b11","#3b3b3b","#000000"]};a.fn.mColorPicker.start=function(){a('input[data-mcolorpicker!="true"]').filter(function(){return c.replace=="[type=color]"?this.getAttribute("type")=="color":a(this).is(c.replace)}).mColorPicker()};a.fn.mColorPicker.events=function(){a("#mColorPickerBg").live("click",a.fn.mColorPicker.closePicker);a(".mColorPicker").live("keyup",function(){try{a(this).css({"background-color":a(this).val()}).css({color:a.fn.mColorPicker.textColor(a(this).css("background-color"))}).trigger("change")}catch(b){}});a(".mColorPickerTrigger").live("click",a.fn.mColorPicker.colorShow);a(".mColor, .mPastColor").live("mousemove",function(c){if(!b.changeColor)return false;var d=a(this),e=d.offset(),f=b.currentInput,g=f.attr("data-hex")||f.attr("hex");b.color=d.css("background-color");if(d.hasClass("mPastColor"))b.color=a.fn.mColorPicker.setColor(b.color,g);else if(d.hasClass("mColorTransparent"))b.color="transparent";else if(!d.hasClass("mPastColor"))b.color=a.fn.mColorPicker.whichColor(c.pageX-e.left,c.pageY-e.top,g);b.currentInput.mSetInputColor(b.color)}).live("click",a.fn.mColorPicker.colorPicked);a("#mColorPickerInput").live("keyup",function(c){try{b.color=a(this).val();b.currentInput.mSetInputColor(b.color);if(c.which==13)a.fn.mColorPicker.colorPicked()}catch(d){}}).live("blur",function(){b.currentInput.mSetInputColor(b.color)});a("#mColorPickerWrapper").live("mouseleave",function(){var c=b.currentInput,d=c.attr("data-hex")||c.attr("hex");if(!b.changeColor)return false;if(d=="true"){b.currentInput.mSetInputColor(a.fn.mColorPicker.RGBtoHex(b.currentColor))}else{b.currentInput.mSetInputColor(b.currentColor)}})};a.fn.mColorPicker.drawPickerTriggers=function(){var d=a(this),f=d.attr("id")||"color_"+c.index++,h=d.attr("text")=="hidden"||d.attr("data-text")=="hidden"?true:false,i=a.fn.mColorPicker.setColor(d.val(),d.attr("data-hex")||d.attr("hex")),j=d.width(),k=d.height(),l=d.css("float"),m=a(g),n=a(g),o="",p;m.attr({id:"color_work_area","class":"mColorPickerInput"}).appendTo(e);n.attr({id:"mcp_"+f,"class":"mColorPickerTrigger"}).css({background:"url("+b.imageFolder+"color.png) 0 0 no-repeat",width:"16px",height:"16px",display:"inline-block",margin:"0 0 -4px 5px",cursor:"pointer"}).insertAfter(d);m.append(d);o=m.html().replace(/type="color"/gi,'type="'+(h?"hidden":"text")+'"');m.html("").remove();p=a(o).attr("id",f).addClass("mColorPicker").val(i).insertBefore(n);if(h)n.css({border:"1px solid black","float":l,width:j,height:k}).addClass(p.attr("class")).html(" ");p.mSetInputColor(i);return p};a.fn.mColorPicker.drawPicker=function(){var h=a(f),m=a("<a>"),n=a(f),o=a(f);j.attr({id:"mColorPickerBg"}).css({display:"none",background:"black",opacity:.01,position:"absolute",top:0,right:0,bottom:0,left:0}).appendTo(e);i.attr({id:"mColorPicker","data-mcolorpicker":true}).css({position:"absolute",border:"1px solid #ccc",color:"#fff",width:"194px",height:"184px","font-size":"12px","font-family":"times",display:"none"}).appendTo(e);k.attr({id:"mColorPickerTest"}).css({display:"none"}).appendTo(e);o.attr({id:"mColorPickerWrapper"}).css({position:"relative",border:"solid 1px gray"}).appendTo(i);a(f).attr({id:"mColorPickerImg","class":"mColor"}).css({height:"136px",width:"192px",border:0,cursor:"crosshair","background-image":"url("+b.imageFolder+"picker.png)"}).appendTo(o);h.attr({id:"mColorPickerSwatches"}).css({"border-right":"1px solid #000"}).appendTo(o);a(f).addClass("mClear").css({clear:"both"}).appendTo(h);for(d=9;d>-1;d--){a(f).attr({id:"cell"+d,"class":"mPastColor"+(d>0?" mNoLeftBorder":"")}).css({"background-color":b.swatches[d].toLowerCase(),height:"18px",width:"18px",border:"1px solid #000","float":"left"}).html(" ").prependTo(h)}n.attr({id:"mColorPickerFooter"}).css({"background-image":"url("+b.imageFolder+"grid.gif)",position:"relative",height:"26px"}).appendTo(o);l.attr({id:"mColorPickerInput",type:"text"}).css({border:"solid 1px gray","font-size":"10pt",margin:"3px",width:"80px"}).appendTo(n);if(c.allowTransparency)a(g).attr({id:"mColorPickerTransparent","class":"mColor mColorTransparent"}).css({"font-size":"16px",color:"#000","padding-right":"30px","padding-top":"3px",cursor:"pointer",overflow:"hidden","float":"right"}).text("transparent").appendTo(n);if(c.showLogo)m.attr({href:"http://meta100.com/",title:c.slogan,alt:c.slogan,target:"_blank"}).css({"float":"right"}).appendTo(n);a(".mNoLeftBorder").css({"border-left":0})};a.fn.mColorPicker.closePicker=function(){j.hide();i.fadeOut()};a.fn.mColorPicker.colorShow=function(){var c=a(this),d=c.attr("id").replace("mcp_",""),e=c.offset(),f=a("#"+d),g=e.top+c.outerHeight(),k=e.left;if(f.attr("disabled"))return false;b.currentColor=f.css("background-color");b.changeColor=true;b.currentInput=f;b.currentId=d;if(g+i.height()>h.height())g=e.top-i.height();if(k+i.width()>h.width())k=e.left-i.width()+c.outerWidth();i.css({top:g+"px",left:k+"px"}).fadeIn("fast");j.show();if(a("#"+d).attr("data-text"))b.color=c.css("background-color");else b.color=f.css("background-color");b.color=a.fn.mColorPicker.setColor(b.color,f.attr("data-hex")||f.attr("hex"));l.val(b.color)};a.fn.mColorPicker.setInputColor=function(b,c){a("#"+b).mSetInputColor(c)};a.fn.mSetInputColor=function(c){var d=a(this),e={"background-color":c,"background-image":c=="transparent"?"url('"+b.imageFolder+"grid.gif')":"",color:a.fn.mColorPicker.textColor(c)};if(d.attr("data-text")||d.attr("text"))d.next().css(e);d.val(c).css(e).trigger("change");l.val(c)};a.fn.mColorPicker.textColor=function(b){b=a.fn.mColorPicker.RGBtoHex(b);if(typeof b=="undefined"||b=="transparent")return"black";return parseInt(b.substr(1,2),16)+parseInt(b.substr(3,2),16)+parseInt(b.substr(5,2),16)<400?"white":"black"};a.fn.mColorPicker.setCookie=function(a,b,c){var d=a+"="+escape(b),e=new Date;e.setDate(e.getDate()+c);d+="; expires="+e.toGMTString();document.cookie=d};a.fn.mColorPicker.getCookie=function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");if(b)return unescape(b[2]);else return null};a.fn.mColorPicker.colorPicked=function(){b.changeColor=false;a.fn.mColorPicker.closePicker();a.fn.mColorPicker.addToSwatch();b.currentInput.trigger("colorpicked")};a.fn.mColorPicker.addToSwatch=function(e){if(!c.enhancedSwatches)return false;var f=[];d=0;if(typeof e=="string")b.color=e.toLowerCase();if(b.color!="transparent")f[0]=b.color.toLowerCase();a(".mPastColor").each(function(){var c=a(this);b.color=c.css("background-color").toLowerCase();if(b.color!=f[0]&&a.fn.mColorPicker.RGBtoHex(b.color)!=f[0]&&a.fn.mColorPicker.hexToRGB(b.color)!=f[0]&&f.length<10)f[f.length]=b.color;a(this).css("background-color",f[d++])});if(c.enhancedSwatches)a.fn.mColorPicker.setCookie("swatches",f.join("||"),365)};a.fn.mColorPicker.whichColor=function(b,c,d){var e=[255,255,255];if(b<32){e[1]=b*8;e[2]=0}else if(b<64){e[0]=256-(b-32)*8;e[2]=0}else if(b<96){e[0]=0;e[2]=(b-64)*8}else if(b<128){e[0]=0;e[1]=256-(b-96)*8}else if(b<160){e[0]=(b-128)*8;e[1]=0}else{e[1]=0;e[2]=256-(b-160)*8}for(var f=0;f<3;f++){if(c<64)e[f]+=(256-e[f])*(64-c)/64;else if(c<=128)e[f]-=e[f]*(c-64)/64;else if(c>128)e[f]=256-b/192*256;e[f]=Math.round(Math.min(e[f],255));if(d=="true")e[f]=a.fn.mColorPicker.decToHex(e[f])}if(d=="true")return"#"+e.join("");return"rgb("+e.join(", ")+")"};a.fn.mColorPicker.setColor=function(b,c){if(c=="true")return a.fn.mColorPicker.RGBtoHex(b);return a.fn.mColorPicker.hexToRGB(b)};a.fn.mColorPicker.colorTest=function(a){k.css("background-color",a);return k.css("background-color")};a.fn.mColorPicker.decToHex=function(a){var b="0123456789abcdef";a=parseInt(a);return String(b.charAt(Math.floor(a/16)))+String(b.charAt(a-Math.floor(a/16)*16))};a.fn.mColorPicker.RGBtoHex=function(b){var c="#",d;b=b?b.toLowerCase():false;if(!b)return"";if(p.test(b))return b.substr(0,7);if(o.test(b))return b.replace(n,"$1$1$2$2$3$3").substr(0,7);if(d=b.match(m)){for(var e=1;e<4;e++)c+=a.fn.mColorPicker.decToHex(d[e]);return c}return a.fn.mColorPicker.colorTest(b)};a.fn.mColorPicker.hexToRGB=function(b){b=b?b.toLowerCase():false;if(!b)return"";if(m.test(b))return b;if(o.test(b)){if(!p.test(b))b=b.replace(n,"$1$1$2$2$3$3");return"rgb("+parseInt(b.substr(1,2),16)+", "+parseInt(b.substr(3,2),16)+", "+parseInt(b.substr(5,2),16)+")"}return a.fn.mColorPicker.colorTest(b)};c=a.fn.mColorPicker.init;h.ready(function(){e=a("body");a.fn.mColorPicker.events();if(c.replace){if(typeof a.fn.livequery=="function")a(c.replace).livequery(a.fn.mColorPicker.start);else a(document).live("ajaxSuccess.mColorPicker",a.fn.mColorPicker.start)}})})(jQuery);
